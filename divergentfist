-- ==========================================
-- DIVERGENT FIST (INVISIBLE PROXY FLING)
-- ==========================================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local mouse = player:GetMouse()

local tool = Instance.new("Tool")
tool.Name = "Divergent Fist"
tool.RequiresHandle = false
tool.Parent = player:WaitForChild("Backpack")

local isEquipped, canAttack = false, true
local proxyPart = nil

-- [FLING PARÇASI OLUŞTURUCU]
local function createProxy()
    local p = Instance.new("Part")
    p.Name = "FlingProxy"
    p.Size = Vector3.new(5, 5, 5) -- Uçurma alanı boyutu
    p.Transparency = 1 -- Görünmez
    p.CanCollide = false
    p.Massless = true
    p.Parent = workspace
    
    -- Fiziksel dönüş gücü (Bu uçuran kısım)
    local bv = Instance.new("AngularVelocity", p)
    bv.MaxTorque = math.huge
    bv.AngularVelocity = Vector3.new(0, 99999, 0)
    bv.RelativeTo = Enum.ActuatorRelativeTo.Attachment0
    
    local att = Instance.new("Attachment", p)
    bv.Attachment0 = att
    
    return p
end

-- [ANA MOTOR]
RunService.Heartbeat:Connect(function()
    if isEquipped and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local HRP = player.Character.HumanoidRootPart
        local hum = player.Character:FindFirstChild("Humanoid")
        
        -- 1. HIZ MOTORU (Kendi ekranında pürüzsüz)
        if hum and hum.MoveDirection.Magnitude > 0 then
            HRP.AssemblyLinearVelocity = Vector3.new(
                hum.MoveDirection.X * 42,
                HRP.AssemblyLinearVelocity.Y,
                hum.MoveDirection.Z * 42
            )
        end
        
        -- 2. PROXY FLING (Senin yerine o döner)
        if not proxyPart or not proxyPart.Parent then
            proxyPart = createProxy()
        end
        
        -- Görünmez parçayı senin pozisyonuna kitler ama rotasyonunu bozmaz
        proxyPart.CFrame = HRP.CFrame
        proxyPart.Velocity = HRP.Velocity
        
        -- Karakterinin kendi spinini tamamen kapatıyoruz (Sarsıntı sıfırlanır)
        HRP.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
    else
        if proxyPart then proxyPart:Destroy(); proxyPart = nil end
    end
end)

-- [VURUŞ MANTIĞI - SENİN ORİJİNAL KODUN]
tool.Activated:Connect(function()
    if not canAttack or not player.Character then return end
    local HRP = player.Character.HumanoidRootPart
    local target = mouse.Target
    
    if target and target.Parent and target.Parent:FindFirstChild("HumanoidRootPart") then
        local enemyHRP = target.Parent.HumanoidRootPart
        if (HRP.Position - enemyHRP.Position).Magnitude < 10 then
            canAttack = false
            enemyHRP.AssemblyLinearVelocity = Vector3.new(0,0,0)
            task.wait(0.12)
            
            local oldCF = HRP.CFrame
            local power = (UserInputService.MouseBehavior == Enum.MouseBehavior.LockCenter) and 12000 or 22000
            
            HRP.CFrame = enemyHRP.CFrame * CFrame.new(0, 0, 0.4)
            HRP.AssemblyLinearVelocity = (HRP.CFrame.LookVector * power) + Vector3.new(0, 8000, 0)
            
            task.wait(0.05)
            HRP.CFrame = oldCF
            HRP.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
            
            task.wait(0.6)
            canAttack = true
        end
    end
end)

-- [EQUIP/UNEQUIP]
tool.Equipped:Connect(function() isEquipped = true end)
tool.Unequipped:Connect(function() 
    isEquipped = false 
    if proxyPart then proxyPart:Destroy(); proxyPart = nil end
end)
